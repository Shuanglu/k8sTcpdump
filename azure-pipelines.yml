trigger: 
 - main

pool:
   vmImage: 'ubuntu-latest'

steps: 
- task: GoTool@0
  inputs:
    version: '1.13.5'
- task: Go@0
  inputs:
    command: 'get'
    arguments: '-d'
    workingDirectory: '$(System.DefaultWorkingDirectory)'
- task: CmdLine@2
  inputs:
    script: 'wget https://github.com/upx/upx/releases/download/v3.96/upx-3.96-amd64_linux.tar.xz && tar -xvf ./upx-3.96-amd64_linux.tar.xz'
- task: Go@0
  inputs:
    command: 'build'
    workingDirectory: '$(System.DefaultWorkingDirectory)'
    arguments: '-o "$(System.DefaultWorkingDirectory)/k8stcpdump" -ldflags="-s -w"'
- task: CmdLine@2
  inputs:
    script: './upx-3.96-amd64_linux/upx --brute $(System.DefaultWorkingDirectory)/k8stcpdump'
- task: CopyFiles@2
  inputs:
    Contents: $(System.DefaultWorkingDirectory)/k8stcpdump
    TargetFolder: '$(Build.ArtifactStagingDirectory)/k8stcpdump'
- task: PublishBuildArtifacts@1
  inputs:
     artifactName: k8stcpdump